{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"SecSwitches/","title":"\ud83d\ude80 Gu\u00eda Completa de Seguridad en Switches Cisco","text":""},{"location":"SecSwitches/#1-vlans-virtual-local-area-networks","title":"\ud83d\udcda 1. VLANs (Virtual Local Area Networks)","text":""},{"location":"SecSwitches/#concepto-teorico-detallado","title":"Concepto Te\u00f3rico Detallado","text":"<p>\u00bfQu\u00e9 es una VLAN? Una VLAN es una red l\u00f3gica independiente dentro de una red f\u00edsica. Imagina un edificio de oficinas donde cada departamento tiene su propio espacio privado aunque compartan el mismo edificio f\u00edsico.</p> <p>Problema que resuelve:</p> <ul> <li>Dominios de broadcast grandes: Sin VLANs, toda la red recibe tr\u00e1fico broadcast</li> <li>Seguridad: Dispositivos en diferentes departamentos pueden comunicarse libremente</li> <li>Rendimiento: Tr\u00e1fico innecesario en todos los puertos</li> </ul> <p>Tipos de VLANs:</p> <ul> <li>VLAN de datos: Para usuarios finales</li> <li>VLAN de voz: Para tr\u00e1fico VoIP (prioridad alta)</li> <li>VLAN de administraci\u00f3n: Para gesti\u00f3n del switch</li> <li>VLAN nativa: Para tr\u00e1fico sin etiquetar en trunks</li> </ul> <p></p> <p></p>"},{"location":"SecSwitches/#que-es-un-trunk","title":"\u00bfQu\u00e9 es un trunk?","text":"<p>Un trunk es un enlace de red que transporta m\u00faltiples VLANs simult\u00e1neamente entre switches o entre un switch y un router.*</p>"},{"location":"SecSwitches/#analogia-para-entenderlo","title":"Analog\u00eda para Entenderlo","text":"<pre><code># SIN TRUNK (Access Ports):\nCada VLAN = Carretera separada\nPuerto access = Rampa de entrada/salida a UNA carretera\n\n# CON TRUNK:\nTrunk = Autopista con M\u00daLTIPLES carriles (cada carril = una VLAN)\nCada frame lleva \"etiqueta\" que dice a qu\u00e9 carril (VLAN) pertenece\n</code></pre>"},{"location":"SecSwitches/#problema-que-resuelve","title":"Problema que Resuelve","text":"<pre><code># ESCENARIO SIN TRUNK:\nSwitch A (VLAN 10,20,30) --- Switch B (VLAN 10,20,30)\nNecesitar\u00edas: 3 cables separados (uno por VLAN)\n\u274c Ineficiente \u274c Costoso \u274c No escalable\n\n# ESCENARIO CON TRUNK:\nSwitch A (VLAN 10,20,30) ---[UN CABLE]--- Switch B (VLAN 10,20,30)\n\u2705 Un solo cable transporta TODAS las VLANs\n\u2705 Eficiente \u2705 Escalable \u2705 Flexible\n</code></pre>"},{"location":"SecSwitches/#como-funciona-el-trunking-tecnicamente","title":"\ud83c\udfd7\ufe0f C\u00f3mo Funciona el Trunking T\u00e9cnicamente","text":""},{"location":"SecSwitches/#protocolo-8021q-dot1q","title":"Protocolo 802.1Q (Dot1Q)","text":""},{"location":"SecSwitches/#ejemplo-de-etiquetado","title":"Ejemplo de Etiquetado","text":""},{"location":"SecSwitches/#configuracion-de-trunks-en-cisco","title":"\u2699\ufe0f Configuraci\u00f3n de Trunks en Cisco","text":""},{"location":"SecSwitches/#comandos-basicos","title":"Comandos B\u00e1sicos","text":"<pre><code>! CONFIGURAR PUERTO COMO TRUNK\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# switchport mode trunk\n! El puerto ahora transporta TODAS las VLANs\n\n! LIMITAR VLANs PERMITIDAS EN EL TRUNK\nSwitch(config-if)# switchport trunk allowed vlan 10,20,30\n! Solo estas VLANs pueden pasar por el trunk\n\n! VERIFICACI\u00d3N\nSwitch# show interfaces trunk\nPort        Mode         Encapsulation  Status        Native vlan\nGi0/1       on           802.1q         trunking      1\nPort        Vlans allowed on trunk\nGi0/1       10,20,30\n</code></pre>"},{"location":"SecSwitches/#modos-de-operacion-de-puertos","title":"Modos de Operaci\u00f3n de Puertos","text":"<pre><code># SWITCHPORT MODE TRUNK \u2192 Forza trunk, negocia DTP\n# SWITCHPORT MODE DYNAMIC DESIRABLE \u2192 Intenta formar trunk\n# SWITCHPORT MODE DYNAMIC AUTO \u2192 Espera que otro inicie trunk  \n# SWITCHPORT MODE ACCESS \u2192 Solo una VLAN (no trunk)\n</code></pre>"},{"location":"SecSwitches/#que-es-la-vlan-nativa","title":"\ud83c\udff7\ufe0f \u00bfQu\u00e9 es la VLAN NATIVA?","text":""},{"location":"SecSwitches/#concepto-fundamental","title":"Concepto Fundamental","text":"<p>La VLAN nativa es la \u00fanica VLAN cuyos frames viajan SIN etiqueta 802.1Q a trav\u00e9s de un trunk.</p>"},{"location":"SecSwitches/#proposito-de-la-vlan-nativa","title":"Prop\u00f3sito de la VLAN Nativa","text":"<pre><code># COMUNICACI\u00d3N CON DISPOSITIVOS QUE NO ENTIENDEN 802.1Q\n- Dispositivos legacy\n- Algunos servidores\n- Equipos de red antiguos\n- Dispositivos que no soportan VLAN tagging\n</code></pre>"},{"location":"SecSwitches/#comportamiento","title":"Comportamiento","text":"<pre><code># PARA TR\u00c1FICO DE VLAN NATIVA:\nFrame entra al trunk \u2192 NO se a\u00f1ade etiqueta 802.1Q\nFrame sale del trunk \u2192 Se asume que pertenece a VLAN nativa\n\n# PARA TR\u00c1FICO DE OTRAS VLANs:\nFrame entra al trunk \u2192 SE A\u00d1ADE etiqueta 802.1Q con VLAN ID\nFrame sale del trunk \u2192 SE REMUEVE etiqueta, se env\u00eda a VLAN correcta\n</code></pre>"},{"location":"SecSwitches/#importante-consideraciones-de-seguridad","title":"\u26a0\ufe0f IMPORTANTE: Consideraciones de Seguridad","text":""},{"location":"SecSwitches/#problema-de-seguridad-con-vlan-nativa","title":"Problema de Seguridad con VLAN Nativa","text":"<pre><code># ATAQUE DE SALTO DE VLAN (VLAN HOPPING)\nAtacante puede:\n1. Enviar frames etiquetados con VLAN nativa\n2. Switch puede remover etiqueta y enviar a VLAN nativa\n3. Posible acceso no autorizado a VLAN nativa\n\n# SOLUCI\u00d3N RECOMENDADA:\nNUNCA usar VLAN 1 como nativa\nUsar VLAN \"basura\" no utilizada para nativa\n</code></pre>"},{"location":"SecSwitches/#configuracion-segura","title":"Configuraci\u00f3n Segura","text":"<pre><code>! CONFIGURACI\u00d3N NO SEGURA (POR DEFECTO)\nSwitch(config-if)# switchport trunk native vlan 1\n! \u274c VLAN 1 es default y puede tener dispositivos\n\n! CONFIGURACI\u00d3N SEGURA (RECOMENDADA)\nSwitch(config-if)# switchport trunk native vlan 999\nSwitch(config)# vlan 999  \nSwitch(config-vlan)# name VLAN_BASURA_NATIVA\nSwitch(config-vlan)# exit\n! \u2705 VLAN 999 no tiene dispositivos, solo existe para tr\u00e1fico nativo\n</code></pre>"},{"location":"SecSwitches/#configuracion-completa-y-segura","title":"\ud83d\udd27 Configuraci\u00f3n Completa y Segura","text":""},{"location":"SecSwitches/#ejemplo-practico-corporativo","title":"Ejemplo Pr\u00e1ctico Corporativo","text":"<pre><code>! ESCENARIO: Empresa con 3 departamentos + VLAN de administraci\u00f3n\n\n! CREAR VLANs\nSwitch(config)# vlan 10\nSwitch(config-vlan)# name VENTAS\nSwitch(config-vlan)# vlan 20\nSwitch(config-vlan)# name IT\nSwitch(config-vlan)# vlan 30\nSwitch(config-vlan)# name CONTABILIDAD\nSwitch(config-vlan)# vlan 99\nSwitch(config-vlan)# name ADMIN\nSwitch(config-vlan)# vlan 999\nSwitch(config-vlan)# name NATIVA_SEGURA\nSwitch(config-vlan)# exit\n! CONFIGURAR TRUNK SEGURO\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# description TRUNK_TO_CORE_SWITCH\nSwitch(config-if)# switchport mode trunk\nSwitch(config-if)# switchport trunk native vlan 999\nSwitch(config-if)# switchport trunk allowed vlan 10,20,30,99\n! \u2705 Solo las VLANs necesarias\n! \u2705 VLAN nativa segura (999)\n! \u2705 Explic\u00edtamente no permite VLAN 1\n! CONFIGURAR EL OTRO EXTREMO (SWITCH CORE)\nCoreSwitch(config)# interface gigabitethernet 0/1  \nCoreSwitch(config-if)# description TRUNK_TO_ACCESS_SWITCH\nCoreSwitch(config-if)# switchport mode trunk\nCoreSwitch(config-if)# switchport trunk native vlan 999\nCoreSwitch(config-if)# switchport trunk allowed vlan 10,20,30,99\n</code></pre>"},{"location":"SecSwitches/#configuracion-de-puertos-de-acceso","title":"Configuraci\u00f3n de Puertos de Acceso","text":"<pre><code>! PUERTOS PARA USUARIOS (NO TRUNK)\nSwitch(config)# interface range fastethernet 0/1-8\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# switchport access vlan 10\nSwitch(config-if-range)# description USUARIOS_VENTAS\nSwitch(config)# interface range fastethernet 0/9-16  \nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# switchport access vlan 20\nSwitch(config-if-range)# description USUARIOS_IT\n</code></pre>"},{"location":"SecSwitches/#verificacion-y-troubleshooting","title":"\ud83d\udcca Verificaci\u00f3n y Troubleshooting","text":""},{"location":"SecSwitches/#comandos-de-verificacion","title":"Comandos de Verificaci\u00f3n","text":"<pre><code>! VER ESTADO DE TRUNKS\nSwitch# show interfaces trunk\nPort        Mode         Encapsulation  Status        Native vlan\nGi0/1       on           802.1q         trunking      999\nGi0/2       auto         802.1q         trunking      1\nPort        Vlans allowed on trunk\nGi0/1       10,20,30,99\nGi0/2       1-4094\n\n! VER CONFIGURACI\u00d3N DE INTERFAZ ESPEC\u00cdFICA\nSwitch# show interfaces gigabitethernet 0/1 switchport\nName: Gi0/1\nSwitchport: Enabled\nAdministrative Mode: trunk\nOperational Mode: trunk\nAdministrative Trunking Encapsulation: dot1q\nOperational Trunking Encapsulation: dot1q\nNegotiation of Trunking: On\nAccess Mode VLAN: 1 (default)\nTrunking Native Mode VLAN: 999 (VLAN_BASURA_NATIVA)\nTrunking VLANs Enabled: 10,20,30,99\n\n! VER ESTAD\u00cdSTICAS DE TRUNK\nSwitch# show interfaces gigabitethernet 0/1 trunk\nPort        Vlans allowed on trunk\nGi0/1       10,20,30,99\n\nPort        Vlans allowed and active in management domain\nGi0/1       10,20,30,99\n\nPort        Vlans in spanning tree forwarding state and not pruned\nGi0/1       10,20,30,99\n</code></pre>"},{"location":"SecSwitches/#troubleshooting-comun","title":"Troubleshooting Com\u00fan","text":"<pre><code># PROBLEMA 1: Trunk no se forma\nCAUSA: Mismatch en configuraci\u00f3n de trunk\nSOLUCI\u00d3N: Verificar que ambos lados est\u00e9n en \"switchport mode trunk\"\n# PROBLEMA 2: VLAN nativa mismatch  \nCAUSA: Diferente VLAN nativa en cada extremo\nS\u00cdNTOMA: P\u00e9rdida de conectividad para VLAN nativa\nSOLUCI\u00d3N: Configurar misma VLAN nativa en ambos extremos\n\n# PROBLEMA 3: VLAN no permitida en trunk\nCAUSA: VLAN no est\u00e1 en \"allowed vlan list\"\nS\u00cdNTOMA: Dispositivos en esa VLAN no pueden comunicarse through trunk\nSOLUCI\u00d3N: A\u00f1adir VLAN a la lista permitida\n</code></pre>"},{"location":"SecSwitches/#resumen-de-conceptos-clave","title":"\ud83c\udfaf Resumen de Conceptos Clave","text":""},{"location":"SecSwitches/#trunk","title":"TRUNK:","text":"<pre><code>\u2705 Transporta M\u00daLTIPLES VLANs en un solo enlace f\u00edsico\n\u2705 Usa etiquetado 802.1Q para identificar a qu\u00e9 VLAN pertenece cada frame\n\u2705 Esencial para conectar switches en redes con m\u00faltiples VLANs\n\u2705 Debe configurarse igual en ambos extremos del enlace\n</code></pre>"},{"location":"SecSwitches/#vlan-nativa","title":"VLAN NATIVA:","text":"<pre><code>\u2705 \u00danica VLAN que viaja SIN etiqueta 802.1Q en un trunk\n\u2705 Por defecto es VLAN 1 (\u274c INSECURO)\n\u2705 Mejor pr\u00e1ctica: Usar VLAN no utilizada (ej: 999)\n\u2705 Debe coincidir en ambos extremos del trunk\n</code></pre>"},{"location":"SecSwitches/#mejores-practicas","title":"MEJORES PR\u00c1CTICAS:","text":"<pre><code>1. \u2705 NUNCA usar VLAN 1 para nada\n2. \u2705 Usar VLAN dedicada no utilizada como nativa (999, 4094, etc.)\n3. \u2705 Limitar VLANs permitidas en trunk solo a las necesarias\n4. \u2705 Deshabilitar puertos no utilizados\n5. \u2705 Configurar manualmente trunks en lugar de usar auto-negotiation\n6. \u2705 Documentar configuraci\u00f3n de trunks\n</code></pre>"},{"location":"SecSwitches/#comandos-explicados-paso-a-paso","title":"Comandos Explicados Paso a Paso","text":"<pre><code>! CREACI\u00d3N DE VLANs\nSwitch# configure terminal\nSwitch(config)# vlan 10\n! El comando 'vlan 10' crea o entra en la configuraci\u00f3n de la VLAN 10\n! Las VLANs 1-1005 son est\u00e1ndar, 1006-4094 son extendidas\n\nSwitch(config-vlan)# name VENTAS\n! 'name' asigna un nombre descriptivo para identificar la VLAN f\u00e1cilmente\n\nSwitch(config-vlan)# exit\n! Sale del modo de configuraci\u00f3n de VLAN\n\n! ASIGNACI\u00d3N DE PUERTOS A VLANs\nSwitch(config)# interface fastethernet 0/1\n! Selecciona el puerto f\u00edsico para configurar\n\nSwitch(config-if)# switchport mode access\n! 'switchport mode access' configura el puerto como acceso (solo una VLAN)\n! Esto significa que el dispositivo conectado no espera etiquetas VLAN\n\nSwitch(config-if)# switchport access vlan 10\n! Asigna el puerto espec\u00edficamente a la VLAN 10\n! El dispositivo conectado estar\u00e1 en la red l\u00f3gica de VENTAS\n\n! CONFIGURACI\u00d3N DE PUERTOS TRUNK\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# switchport mode trunk\n! 'switchport mode trunk' configura el puerto para transportar m\u00faltiples VLANs\n! Los trunks usan etiquetas 802.1Q para identificar a qu\u00e9 VLAN pertenece cada frame\n\nSwitch(config-if)# switchport trunk native vlan 999\n! 'native vlan' define qu\u00e9 VLAN viaja sin etiquetar\n! Por seguridad, NUNCA usar VLAN 1 como nativa\n\nSwitch(config-if)# switchport trunk allowed vlan 10,20,30\n! 'allowed vlan' especifica qu\u00e9 VLANs pueden pasar por el trunk\n! Esto proporciona control granular sobre qu\u00e9 VLANs se propagan\n\n! VERIFICACI\u00d3N\nSwitch# show vlan brief\n! Muestra todas las VLANs y qu\u00e9 puertos est\u00e1n asignados a cada una\nSwitch# show interfaces trunk\n! Muestra informaci\u00f3n detallada sobre puertos trunk\n</code></pre>"},{"location":"SecSwitches/#ejemplo-practico-completo","title":"Ejemplo Pr\u00e1ctico Completo","text":"<pre><code>! ESCENARIO: Empresa con 3 departamentos\nSwitch(config)# vlan 10\nSwitch(config-vlan)# name VENTAS\nSwitch(config-vlan)# exit\nSwitch(config)# vlan 20\nSwitch(config-vlan)# name IT\nSwitch(config-vlan)# exit\nSwitch(config)# vlan 30\nSwitch(config-vlan)# name CONTABILIDAD\nSwitch(config-vlan)# exit\nSwitch(config)# vlan 99\nSwitch(config-vlan)# name ADMINISTRACION\nSwitch(config-vlan)# exit\n! Asignar puertos a departamentos\nSwitch(config)# interface range fastethernet 0/1-8\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# switchport access vlan 10\nSwitch(config-if-range)# description PUERTOS_VENTAS\nSwitch(config)# interface range fastethernet 0/9-16\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# switchport access vlan 20\nSwitch(config-if-range)# description PUERTOS_IT\n! Configurar IP de gesti\u00f3n en VLAN de administraci\u00f3n\nSwitch(config)# interface vlan 99\nSwitch(config-if)# ip address 192.168.99.10 255.255.255.0\nSwitch(config-if)# no shutdown\n! Esto permite administrar el switch remotamente mediante SSH/Telnet\n</code></pre>"},{"location":"SecSwitches/#2-port-security","title":"\ud83d\udd12 2. Port Security","text":""},{"location":"SecSwitches/#concepto-teorico-detallado_1","title":"Concepto Te\u00f3rico Detallado","text":"<p>\u00bfQu\u00e9 es Port Security? Es un mecanismo que restringe qu\u00e9 dispositivos pueden conectarse a un puerto del switch bas\u00e1ndose en direcciones MAC.</p> <p></p> <p>Problemas que resuelve:</p> <ul> <li>Conectividad no autorizada: Evita que usuarios conecten dispositivos no autorizados</li> <li>Ataques MAC flooding: Previene que atacantes saturen la tabla MAC</li> <li>Robo de puertos: Impide usar puertos f\u00edsicos para acceso no autorizado</li> </ul> <p>Mecanismos de aprendizaje de MAC:</p> <ul> <li>Est\u00e1ticas: Se configuran manualmente</li> <li>Din\u00e1micas: El switch aprende autom\u00e1ticamente</li> <li>Sticky: Combina ambos - aprende y luego las hace est\u00e1ticas</li> </ul>"},{"location":"SecSwitches/#comandos-explicados-paso-a-paso_1","title":"Comandos Explicados Paso a Paso","text":"<pre><code>! HABILITAR PORT SECURITY B\u00c1SICO\nSwitch(config)# interface fastethernet 0/1\nSwitch(config-if)# switchport mode access\n! PRIMERO debe ser puerto de acceso para habilitar port security\n\nSwitch(config-if)# switchport port-security\n! Este comando ACTIVA la funcionalidad de port security en el puerto\n! Sin esto, los dem\u00e1s comandos de port security no funcionar\u00e1n\n\nSwitch(config-if)# switchport port-security maximum 2\n! 'maximum' define el n\u00famero m\u00e1ximo de direcciones MAC permitidas\n! En este caso, permite hasta 2 dispositivos diferentes\n\n! TIPOS DE VIOLACI\u00d3N - CR\u00cdTICOS PARA ENTENDER\nSwitch(config-if)# switchport port-security violation shutdown\n! 'violation shutdown' - EL M\u00c1S SEGURO\n! - Cierra el puerto inmediatamente\n! - Lo coloca en estado err-disable\n! - Requiere intervenci\u00f3n manual para reactivar\n! - USAR EN ENTORNOS DE ALTA SEGURIDAD\n\nSwitch(config-if)# switchport port-security violation restrict\n! 'violation restrict' - MODO INTERMEDIO\n! - Permite tr\u00e1fico de MACs conocidas\n! - Bloquea tr\u00e1fico de MACs no autorizadas\n! - Genera logs pero mantiene el puerto activo\n! - BUENO para monitoreo sin interrumpir servicio\n\nSwitch(config-if)# switchport port-security violation protect\n! 'violation protect' - MODO MENOS RESTRICTIVO\n! - Solo bloquea frames de MACs no autorizadas\n! - No genera logs de violaci\u00f3n\n! - PUEDE PASAR DESAPERCIBIDO UN ATAQUE\n\n! M\u00c9TODOS DE APRENDIZAJE DE MAC\nSwitch(config-if)# switchport port-security mac-address sticky\n! 'sticky' - EL M\u00c1S PR\u00c1CTICO\n! - Aprende las MACs que se conectan inicialmente\n! - Las convierte en direcciones est\u00e1ticas autom\u00e1ticamente\n! - Se guardan en la configuraci\u00f3n\n! - Perfecto para despliegues iniciales\n\nSwitch(config-if)# switchport port-security mac-address 0000.1111.2222\n! Configuraci\u00f3n MANUAL de MAC espec\u00edfica\n! \u00datil para dispositivos cr\u00edticos como impresoras o servidores\n\n! CONFIGURACIONES AVANZADAS\nSwitch(config-if)# switchport port-security aging time 120\n! 'aging time' define cu\u00e1nto tiempo se mantiene una MAC en la tabla\n! 120 minutos = 2 horas\n\nSwitch(config-if)# switchport port-security aging type inactivity\n! 'inactivity' significa que el temporizador corre solo si no hay tr\u00e1fico\n! Alternativa: 'absolute' (tiempo fijo independiente del tr\u00e1fico)\n</code></pre>"},{"location":"SecSwitches/#ejemplo-practico-completo_1","title":"Ejemplo Pr\u00e1ctico Completo","text":"<pre><code>! ESCENARIO: Oficina con pol\u00edticas de seguridad espec\u00edficas\n\n! Puerto para impresora (1 dispositivo fijo)\nSwitch(config)# interface fastethernet 0/5\nSwitch(config-if)# switchport mode access\nSwitch(config-if)# switchport access vlan 10\nSwitch(config-if)# switchport port-security\nSwitch(config-if)# switchport port-security maximum 1\nSwitch(config-if)# switchport port-security violation shutdown\nSwitch(config-if)# switchport port-security mac-address 0050.56AB.CDEF\nSwitch(config-if)# description IMPRESORA_SALA_VENTAS\n! Puerto para usuarios generales (hasta 3 dispositivos)\nSwitch(config)# interface fastethernet 0/10\nSwitch(config-if)# switchport mode access\nSwitch(config-if)# switchport access vlan 20\nSwitch(config-if)# switchport port-security\nSwitch(config-if)# switchport port-security maximum 3\nSwitch(config-if)# switchport port-security violation restrict\nSwitch(config-if)# switchport port-security mac-address sticky\nSwitch(config-if)# switchport port-security aging time 240\nSwitch(config-if)# description PUESTO_TRABAJO_USUARIO\n! Configurar recuperaci\u00f3n autom\u00e1tica de err-disable\nSwitch(config)# errdisable recovery cause psecure-violation\nSwitch(config)# errdisable recovery interval 300\n! Esto reactiva autom\u00e1ticamente puertos despu\u00e9s de 5 minutos\n\n! VERIFICACI\u00d3N DETALLADA\nSwitch# show port-security\n! Muestra resumen de todos los puertos con port security\n\nSwitch# show port-security interface fastethernet 0/10\n! Muestra detalles espec\u00edficos del puerto:\n! - M\u00e1ximo de direcciones permitidas\n! - Direcciones actualmente aprendidas\n! - Contador de violaciones\n! - Tipo de violaci\u00f3n configurado\n\nSwitch# show port-security address\n! Muestra la tabla de direcciones MAC seguras aprendidas\n</code></pre>"},{"location":"SecSwitches/#3-dhcp-snooping","title":"\ud83c\udf10 3. DHCP Snooping","text":""},{"location":"SecSwitches/#pero-que-es-dhcp","title":"\u00bfPero qu\u00e9 es DHCP?","text":""},{"location":"SecSwitches/#que-es-dhcp","title":"\ud83d\udd04 \u00bfQu\u00e9 es DHCP?","text":"<p>DHCP (Dynamic Host Configuration Protocol) es el \"servicio de entrega de direcciones\" autom\u00e1tico de las redes. En lugar de configurar manualmente cada dispositivo, DHCP asigna autom\u00e1ticamente:</p> <ul> <li>\u2705 Direcci\u00f3n IP</li> <li>\u2705 M\u00e1scara de subred </li> <li>\u2705 Gateway por defecto</li> <li>\u2705 Servidores DNS</li> </ul>"},{"location":"SecSwitches/#el-proceso-de-4-pasos-dora","title":"\ud83d\udce6 El Proceso de 4 Pasos (DORA)","text":""},{"location":"SecSwitches/#1-discover-hay-algun-servidor-dhcp","title":"1. \ud83c\udfaf DISCOVER - \"\u00bfHay alg\u00fan servidor DHCP?\"","text":"<p><pre><code>Cliente \u2192 Broadcast: \"\u00a1Hola! Necesito una IP, \u00bfalguien puede ayudarme?\"\n</code></pre> - El cliente env\u00eda broadcast sin IP - Todos los dispositivos en la red local lo reciben</p>"},{"location":"SecSwitches/#2-offer-si-te-ofrezco-esta-ip","title":"2. \ud83d\udce8 OFFER - \"S\u00ed, te ofrezco esta IP\"","text":"<p><pre><code>Servidor DHCP \u2192 Cliente: \"Te ofrezco la IP 192.168.1.100\"\n</code></pre> - Servidor reserva una IP disponible - Env\u00eda oferta con configuraci\u00f3n de red</p>"},{"location":"SecSwitches/#3-request-acepto-tu-oferta","title":"3. \ud83d\udcdd REQUEST - \"Acepto tu oferta\"","text":"<p><pre><code>Cliente \u2192 Broadcast: \"Acepto la IP 192.168.1.100 del servidor X\"\n</code></pre> - Cliente confirma que acepta la IP - Se hace por broadcast por si hay m\u00faltiples servidores</p>"},{"location":"SecSwitches/#4-ack-confirmado-usa-esta-ip","title":"4. \u2705 ACK - \"Confirmado, usa esta IP\"","text":"<p><pre><code>Servidor DHCP \u2192 Cliente: \"Confirmado, usa 192.168.1.100 por 24 horas\"\n</code></pre> - Confirmaci\u00f3n final del servidor - Incluye tiempo de arrendamiento (lease time)</p>"},{"location":"SecSwitches/#renovacion-de-ip","title":"\u23f0 Renovaci\u00f3n de IP","text":"<pre><code># A LOS 50% DEL TIEMPO DE ARRENDAMIENTO:\nCliente \u2192 Servidor: \"\u00bfPuedo seguir usando esta IP?\"\nServidor \u2192 Cliente: \"S\u00ed, renuevas por X tiempo m\u00e1s\"\n# SI NO HAY RESPUESTA, INTENTA DE NUEVO AL 87.5%\n# SI EXPIRA \u2192 VUELVE AL PASO 1 (DISCOVER)\n</code></pre>"},{"location":"SecSwitches/#en-resumen","title":"\ud83c\udfaf En Resumen","text":"<p>DHCP = Sistema autom\u00e1tico que evita tener que configurar manualmente cada dispositivo en la red, asignando y gestionando direcciones IP de forma din\u00e1mica.</p> <p>Funciona como un \"alquiler de direcciones\" con renovaci\u00f3n autom\u00e1tica.</p>"},{"location":"SecSwitches/#que-es-dhcp-snooping","title":"\u00bfQu\u00e9 es DHCP Snooping?","text":"<p>La funci\u00f3n exacta de DHCP Snooping es actuar como un guardi\u00e1n de seguridad que previene ataques DHCP maliciosos mediante la creaci\u00f3n de una base de datos confiable de asignaciones IP-MAC, diferenciando entre puertos trusted (donde se conectan servidores DHCP leg\u00edtimos) y untrusted (clientes), bloqueando respuestas DHCP no autorizadas y proporcionando la base de datos que tecnolog\u00edas como DAI e IP Source Guard utilizan para validar la legitimidad del tr\u00e1fico ARP y las direcciones IP en la red.</p> <p>En esencia: DHCP Snooping es el sistema de verificaci\u00f3n de identidades que asegura que solo dispositivos autorizados puedan ofrecer direcciones IP y mantiene un registro confiable de qu\u00e9 dispositivo tiene qu\u00e9 IP en qu\u00e9 puerto. DHCP Snooping es la BASE, DAI es la CAPA DE SEGURIDAD que usa esa base</p>"},{"location":"SecSwitches/#analogia-para-entenderlo_1","title":"Analog\u00eda para Entenderlo","text":"<p>Imagina un edificio con: - Servidores DHCP leg\u00edtimos = Oficinas de administraci\u00f3n autorizadas - Clientes DHCP = Inquilinos que necesitan llaves (IPs) - Ataque DHCP Rogue = Alguien fingiendo ser la administraci\u00f3n - DHCP Snooping = El sistema de seguridad que verifica credenciales</p> <p></p> <p></p>"},{"location":"SecSwitches/#problemas-que-resuelve-dhcp-snooping","title":"\ud83d\udd0d Problemas que Resuelve DHCP Snooping","text":""},{"location":"SecSwitches/#1-ataque-dhcp-starvation-inanicion","title":"1. Ataque DHCP Starvation (Inanici\u00f3n)","text":"<pre><code># Un atacante env\u00eda M\u00daLTIPLES solicitudes DHCP con MACs falsas\n# Resultado: Agota el pool de IPs del servidor leg\u00edtimo\n# Clientes leg\u00edtimos no pueden obtener IP\n</code></pre>"},{"location":"SecSwitches/#2-ataque-dhcp-rogue-servidor-falso","title":"2. Ataque DHCP Rogue (Servidor Falso)","text":"<pre><code># Atacante configura servidor DHCP no autorizado\n# Ofrece IPs con:\n# - Gateway falso (el atacante)\n# - DNS falso (para redirigir tr\u00e1fico)\n# Resultado: Man-in-the-Middle completo\n</code></pre>"},{"location":"SecSwitches/#3-ip-spoofing-suplantacion-de-ip","title":"3. IP Spoofing (Suplantaci\u00f3n de IP)","text":"<pre><code># Clientes usan IPs que no les corresponden\n# Dif\u00edcil de rastrear en la red\n# Puede eludir controles de seguridad basados en IP\n</code></pre>"},{"location":"SecSwitches/#arquitectura-de-dhcp-snooping","title":"\ud83c\udfd7\ufe0f Arquitectura de DHCP Snooping","text":""},{"location":"SecSwitches/#componentes-clave","title":"Componentes Clave","text":"<ol> <li> <p>Puertos Trusted (Confiables)</p> <ul> <li>Donde est\u00e1n los servidores DHCP leg\u00edtimos</li> <li>Aceptan mensajes DHCP de cualquier tipo</li> </ul> </li> <li> <p>Puertos Untrusted (No Confiables)</p> <ul> <li>Donde se conectan clientes</li> <li>Solo aceptan solicitudes DHCP (DISCOVER, REQUEST)</li> <li>Rechazan respuestas DHCP (OFFER, ACK)</li> </ul> </li> <li> <p>Binding Database (Base de Datos de Asignaciones)</p> <ul> <li>Almacena: MAC + IP + VLAN + Puerto + Tiempo de arrendamiento</li> <li>Se usa por DAI y IP Source Guard</li> </ul> </li> </ol>"},{"location":"SecSwitches/#configuracion-detallada-paso-a-paso","title":"\u2699\ufe0f Configuraci\u00f3n Detallada Paso a Paso","text":""},{"location":"SecSwitches/#configuracion-basica","title":"Configuraci\u00f3n B\u00e1sica","text":"<pre><code>! PASO 1: HABILITAR DHCP SNOOPING GLOBALMENTE\nSwitch(config)# ip dhcp snooping\n! Este comando ACTIVA la funcionalidad a nivel global\n! Sin esto, nada de DHCP Snooping funcionar\u00e1\n\n! PASO 2: ESPECIFICAR VLANs DONDE ACTUAR\u00c1\nSwitch(config)# ip dhcp snooping vlan 10,20,30\n! Solo las VLANs especificadas estar\u00e1n protegidas\n! Puedes usar rangos: vlan 1-100\n\n! PASO 3: CONFIGURAR PUERTOS TRUSTED\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# description SERVIDOR_DHCP_LEGITIMO\nSwitch(config-if)# ip dhcp snooping trust\n! MARCA este puerto como confiable para respuestas DHCP\n! Los servidores DHCP leg\u00edtimos DEBEN estar en puertos trusted\n\n! PASO 4: PUERTOS UNTRUSTED (POR DEFECTO)\nSwitch(config)# interface range fastethernet 0/1-24\nSwitch(config-if-range)# no ip dhcp snooping trust\n! Expl\u00edcitamente los marca como no confiables\n! Aunque por defecto ya lo son, es buena pr\u00e1ctica\n</code></pre>"},{"location":"SecSwitches/#configuracion-avanzada","title":"Configuraci\u00f3n Avanzada","text":"<pre><code>! OPCI\u00d3N 82 (AGENT INFORMATION OPTION)\nSwitch(config)# ip dhcp snooping information option\n! A\u00f1ade informaci\u00f3n sobre el switch y puerto donde se origin\u00f3 la solicitud\n! Ayuda a los servidores DHCP a tomar decisiones basadas en ubicaci\u00f3n\n\n! LIMITAR TASA DE MENSAJES DHCP\nSwitch(config)# interface fastethernet 0/5\nSwitch(config-if)# ip dhcp snooping limit rate 10\n! Limita a 10 mensajes DHCP por segundo\n! Previene ataques de inundaci\u00f3n (DHCP starvation)\n! CONFIGURACI\u00d3N DE LA BASE DE DATOS\nSwitch(config)# ip dhcp snooping database flash:dhcp-snooping.txt\nSwitch(config)# ip dhcp snooping database write-delay 15\n! Guarda la base de datos en memoria flash cada 15 segundos\n! Previene p\u00e9rdida de informaci\u00f3n en reinicios\n</code></pre>"},{"location":"SecSwitches/#ejemplos-practicos-de-configuracion","title":"\ud83d\udd27 Ejemplos Pr\u00e1cticos de Configuraci\u00f3n","text":""},{"location":"SecSwitches/#ejemplo-1-pequena-oficina","title":"Ejemplo 1: Peque\u00f1a Oficina","text":"<pre><code>! ESCENARIO: 1 servidor DHCP, 24 puertos de usuario\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10\n! Servidor DHCP en puerto Gigabit 0/1\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# description SERVIDOR_DHCP\nSwitch(config-if)# ip dhcp snooping trust\n! Puertos de usuarios (untrusted por defecto)\nSwitch(config)# interface range fastethernet 0/1-24\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# switchport access vlan 10\nSwitch(config-if-range)# ip dhcp snooping limit rate 5\n! Limita a 5 mensajes/segundo para prevenir ataques\n</code></pre>"},{"location":"SecSwitches/#ejemplo-2-empresa-mediana-con-multiples-vlans","title":"Ejemplo 2: Empresa Mediana con M\u00faltiples VLANs","text":"<pre><code>! ESCENARIO: M\u00faltiples departamentos, servidor centralizado\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10,20,30,99\nSwitch(config)# ip dhcp snooping information option\n! Uplink al core donde est\u00e1 el servidor DHCP\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# description UPLINK_TO_CORE\nSwitch(config-if)# switchport mode trunk\nSwitch(config-if)# ip dhcp snooping trust\n! VLAN de Ventas\nSwitch(config)# interface range fastethernet 0/1-8\nSwitch(config-if-range)# switchport access vlan 10\nSwitch(config-if-range)# ip dhcp snooping limit rate 8\n! VLAN de IT\nSwitch(config)# interface range fastethernet 0/9-16\nSwitch(config-if-range)# switchport access vlan 20\nSwitch(config-if-range)# ip dhcp snooping limit rate 8\n! VLAN de Administraci\u00f3n\nSwitch(config)# interface range fastethernet 0/17-24\nSwitch(config-if-range)# switchport access vlan 99\nSwitch(config-if-range)# ip dhcp snooping limit rate 8\n</code></pre>"},{"location":"SecSwitches/#ejemplo-3-entorno-de-alta-seguridad","title":"Ejemplo 3: Entorno de Alta Seguridad","text":"<pre><code>! ESCENARIO: Entorno cr\u00edtico con verificaci\u00f3n estricta\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 1-100\nSwitch(config)# ip dhcp snooping information option\nSwitch(config)# ip dhcp snooping verify mac-address\n! VERIFICA que la MAC origen en DHCP sea la real del cliente\n! Previene suplantaci\u00f3n de MAC en mensajes DHCP\n\n! Base de datos persistente\nSwitch(config)# ip dhcp snooping database flash:dhcp-snooping.db\nSwitch(config)# ip dhcp snooping database timeout 10\nSwitch(config)# ip dhcp snooping database write-delay 10\n! Puertos trusted expl\u00edcitos\nSwitch(config)# interface range gigabitethernet 0/1-2\nSwitch(config-if-range)# description SERVERS_DHCP_TRUSTED\nSwitch(config-if-range)# ip dhcp snooping trust\n! Todos los dem\u00e1s puertos son untrusted con rate limiting estricto\nSwitch(config)# interface range fastethernet 0/1-48\nSwitch(config-if-range)# no ip dhcp snooping trust\nSwitch(config-if-range)# ip dhcp snooping limit rate 5\n! Solo 5 mensajes DHCP por segundo - muy restrictivo\n</code></pre>"},{"location":"SecSwitches/#integracion-con-otras-tecnologias-de-seguridad","title":"\ud83d\udee0\ufe0f Integraci\u00f3n con Otras Tecnolog\u00edas de Seguridad","text":""},{"location":"SecSwitches/#con-dynamic-arp-inspection-dai","title":"Con Dynamic ARP Inspection (DAI)","text":"<pre><code>! DHCP Snooping es PRERREQUISITO para DAI\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10\n! DAI usa la tabla de bindings de DHCP Snooping\nSwitch(config)# ip arp inspection vlan 10\nSwitch(config)# ip arp inspection validate src-mac dst-mac ip\n! DAI verifica que las respuestas ARP coincidan con la tabla de DHCP Snooping\n</code></pre>"},{"location":"SecSwitches/#con-ip-source-guard","title":"Con IP Source Guard","text":"<pre><code>! IP Source Guard tambi\u00e9n depende de DHCP Snooping\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10\nSwitch(config)# interface fastethernet 0/1\nSwitch(config-if)# ip verify source\n! Solo permite tr\u00e1fico de IPs que est\u00e1n en la tabla de DHCP Snooping\n</code></pre>"},{"location":"SecSwitches/#comandos-de-verificacion-y-monitoreo","title":"\ud83d\udcca Comandos de Verificaci\u00f3n y Monitoreo","text":""},{"location":"SecSwitches/#verificacion-basica","title":"Verificaci\u00f3n B\u00e1sica","text":"<pre><code>! VER ESTADO GLOBAL DE DHCP SNOOPING\nSwitch# show ip dhcp snooping\nSwitch DHCP snooping is enabled\nDHCP snooping is configured on following VLANs:\n10,20,30\nDHCP snooping is operational on following VLANs:\n10,20,30\nDHCP snooping is configured on the following L3 Interfaces:\n\nInsertion of option 82 is enabled\n   circuit-id default format: vlan-mod-port\n   remote-id: 0050.5689.ABCD (MAC del switch)\nOption 82 on untrusted port is not allowed\nVerification of hwaddr field is enabled\n\n! MOSTRAR LA TABLA DE BINDINGS\nSwitch# show ip dhcp snooping binding\nMacAddress          IpAddress        Lease(sec)  Type           VLAN  Interface\n------------------  ---------------  ----------  -------------  ----  --------------------\n00:50:56:89:AB:CD   192.168.10.10    86400       dhcp-snooping   10    FastEthernet0/1\n00:50:56:89:AB:CE   192.168.10.11    86320       dhcp-snooping   10    FastEthernet0/2\n00:50:56:89:AB:CF   192.168.20.15    86200       dhcp-snooping   20    FastEthernet0/9\n\n! VER ESTADO DE PUERTOS TRUSTED\nSwitch# show ip dhcp snooping trust\nTrusted | Port | ------- | ---- | yes     | Gi0/1 | no      | Fa0/1 | no      | Fa0/2 | ...     | ...  |\n</code></pre>"},{"location":"SecSwitches/#estadisticas-y-troubleshooting","title":"Estad\u00edsticas y Troubleshooting","text":"<pre><code>! ESTAD\u00cdSTICAS DETALLADAS POR INTERFAZ\nSwitch# show ip dhcp snooping interface fastethernet 0/1\nDHCP Snooping is enabled on this interface\nDHCP Snooping trust is disabled\nDHCP Snooping limit rate is 5 packets per second\nDHCP Snooping violation count is 0\n! CONTADORES DE MENSAJES DHCP\nSwitch# show ip dhcp snooping statistics\nDHCP Snooping Statistics:\n  Packets Dropped:\n    DHCP Discover: 0\nDHCP Offer: 15\nDHCP Request: 0\nDHCP Ack: 12\nOthers: 3\nTotal Packets Dropped: 30\n! VERIFICAR LA BASE DE DATOS\nSwitch# show ip dhcp snooping database\nAgent URL : flash:dhcp-snooping.db\nWrite delay : 15 seconds\nAbort delay : 300 seconds\nAgent running : No\nDelay timer : not running\nReconfigure timer : not running\nLast succeeded : Never\nLast failed : Never\n</code></pre>"},{"location":"SecSwitches/#comandos-de-depuracion-debug","title":"Comandos de Depuraci\u00f3n (Debug)","text":"<pre><code>! SOLO USAR EN TROUBLESHOOTING - PUEDE GENERAR MUCHO OUTPUT\nSwitch# debug ip dhcp snooping events\nDHCP_SNOOPING: received new DHCP packet from interface FastEthernet0/1\nDHCP_SNOOPING: process new DHCP packet, message type: DHCPDISCOVER\nDHCP_SNOOPING: packet passed validation check\n\nSwitch# debug ip dhcp snooping packet\nDHCP_SNOOPING: received packet on FastEthernet0/1: OP: 1, HTYPE: 1, HLEN: 6, HOPS: 0\nXID: 0x45A3F1C2, SECS: 0, FLAGS: 0\nCIADDR: 0.0.0.0, YIADDR: 0.0.0.0, SIADDR: 0.0.0.0, GIADDR: 0.0.0.0\n  CHADDR: 0050.5689.ABCD\n</code></pre>"},{"location":"SecSwitches/#flujo-de-trabajo-completo-de-dhcp-snooping","title":"\ud83d\udd04 Flujo de Trabajo Completo de DHCP Snooping","text":""},{"location":"SecSwitches/#proceso-paso-a-paso","title":"Proceso Paso a Paso","text":"<ol> <li> <p>Inicializaci\u00f3n: <pre><code>Switch arranca \u2192 DHCP Snooping deshabilitado por defecto\nAdministrador ejecuta: ip dhcp snooping\nSe crea tabla de bindings vac\u00eda\n</code></pre></p> </li> <li> <p>Aprendizaje: <pre><code>Cliente conecta en Fa0/1 (untrusted)\nEnv\u00eda DHCP DISCOVER \u2192 Switch permite (solicitud)\nServidor leg\u00edtimo en Gi0/1 (trusted) env\u00eda DHCP OFFER \u2192 Switch permite (trusted)\nCliente env\u00eda DHCP REQUEST \u2192 Switch permite\nServidor env\u00eda DHCP ACK \u2192 Switch permite (trusted)\nSwitch a\u00f1ade binding a la tabla: MAC + IP + VLAN + Puerto\n</code></pre></p> </li> <li> <p>Protecci\u00f3n: <pre><code>Atacante conecta servidor rogue en Fa0/10 (untrusted)\nEnv\u00eda DHCP OFFER no solicitado \u2192 Switch BLOQUEA y registra violaci\u00f3n\nCliente leg\u00edtimo solo ve ofertas del servidor autorizado\n</code></pre></p> </li> <li> <p>Mantenimiento: <pre><code>Switch monitorea renewals y expiraciones\nActualiza tabla de bindings autom\u00e1ticamente\nGuarda base de datos peri\u00f3dicamente en memoria no vol\u00e1til\n</code></pre></p> </li> </ol>"},{"location":"SecSwitches/#mejores-practicas-y-recomendaciones","title":"\ud83d\udca1 Mejores Pr\u00e1cticas y Recomendaciones","text":""},{"location":"SecSwitches/#configuracion-recomendada","title":"Configuraci\u00f3n Recomendada","text":"<pre><code>! CONFIGURACI\u00d3N \u00d3PTIMA PARA ENTORNOS CORPORATIVOS\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan [TODAS_LAS_VLANs_CON_CLIENTES]\nSwitch(config)# ip dhcp snooping information option\nSwitch(config)# ip dhcp snooping verify mac-address\nSwitch(config)# ip dhcp snooping database flash:dhcp-snooping.db\nSwitch(config)# ip dhcp snooping database write-delay 15\n! PUERTOS TRUSTED - SOLO DONDE HAY SERVIDORES DHCP LEG\u00cdTIMOS\nSwitch(config)# interface [PUERTOS_A_SERVIDORES_DHCP]\nSwitch(config-if)# ip dhcp snooping trust\n! PUERTOS UNTRUSTED - TODOS LOS DEM\u00c1S\nSwitch(config)# interface range [TODOS_LOS_PUERTOS_DE_CLIENTES]\nSwitch(config-if-range)# no ip dhcp snooping trust\nSwitch(config-if-range)# ip dhcp snooping limit rate 10\n</code></pre>"},{"location":"SecSwitches/#consideraciones-importantes","title":"Consideraciones Importantes","text":"<ol> <li> <p>Planificaci\u00f3n:</p> <ul> <li>Implementar en ventana de mantenimiento</li> <li>Comenzar en VLANs de prueba</li> <li>Tener rollback plan</li> </ul> </li> <li> <p>Rendimiento:</p> <ul> <li>Rate limiting muy bajo puede afectar clientes leg\u00edtimos</li> <li>Base de datos grande puede consumir memoria</li> </ul> </li> <li> <p>Compatibilidad:</p> <ul> <li>Verificar que dispositivos legados funcionen</li> <li>Algunos dispositivos IoT pueden tener comportamientos DHCP extra\u00f1os</li> </ul> </li> <li> <p>Monitoreo:</p> <ul> <li>Configurar SNMP traps para violaciones</li> <li>Monitorear contadores de paquetes descartados</li> <li>Revisar logs regularmente</li> </ul> </li> </ol>"},{"location":"SecSwitches/#resumen-final","title":"\ud83c\udfaf Resumen Final","text":"<p>DHCP Snooping es la base fundamental para:</p> <ul> <li>\u2705 Prevenir servidores DHCP no autorizados</li> <li>\u2705 Construir la tabla de bindings para DAI e IP Source Guard</li> <li>\u2705 Detectar y prevenir ataques de inundaci\u00f3n DHCP</li> <li>\u2705 Mejorar la trazabilidad de dispositivos en la red</li> </ul> <p>Sin DHCP Snooping, las dem\u00e1s tecnolog\u00edas de seguridad (DAI, IP Source Guard) no pueden funcionar correctamente.</p>"},{"location":"SecSwitches/#3-dynamic-arp-inspection-dai","title":"\ud83d\udee1\ufe0f 3. Dynamic ARP Inspection (DAI)","text":""},{"location":"SecSwitches/#concepto-teorico-detallado_2","title":"Concepto Te\u00f3rico Detallado","text":"<p>\u00bfQu\u00e9 es DAI? Es un mecanismo de seguridad que previene ataques ARP spoofing validando paquetes ARP en la red.</p> <p>Problema del ARP:</p> <ul> <li>ARP no tiene autenticaci\u00f3n \u2192 Cualquiera puede enviar respuestas ARP</li> <li>ARP poisoning: Atacante se hace pasar por el gateway</li> <li>Man-in-the-middle: Intercepta tr\u00e1fico entre v\u00edctima y gateway</li> </ul> <p>C\u00f3mo funciona DAI:</p> <ol> <li>Intercepta todos los paquetes ARP</li> <li>Valida contra base de datos confiable (DHCP Snooping)</li> <li>Descarta paquetes ARP no v\u00e1lidos</li> <li>Registra intentos de violaci\u00f3n</li> </ol> <p>DAI utiliza la tabla de DHCP Snooping EXCLUSIVAMENTE cuando recibe un ARP Response (Respuesta ARP)</p>"},{"location":"SecSwitches/#comandos-explicados-paso-a-paso_2","title":"Comandos Explicados Paso a Paso","text":"<pre><code>! CONFIGURACI\u00d3N B\u00c1SICA DE DAI\nSwitch(config)# ip arp inspection vlan 10,20\n! Habilita DAI para las VLANs especificadas\n! Sin este comando, DAI no est\u00e1 activo en ninguna VLAN\n\n! DEFINIR PUERTOS TRUSTED (CONFIABLES)\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# ip arp inspection trust\n! Los puertos 'trusted' NO son inspeccionados por DAI\n! USAR SOLO en: routers, servidores, switches superiores\n! NUNCA en puertos de usuarios finales\n\n! VALIDACIONES ESPEC\u00cdFICAS\nSwitch(config)# ip arp inspection validate src-mac dst-mac ip\n! 'src-mac' - Verifica que MAC origen en ARP = MAC origen en Ethernet\n! 'dst-mac' - Verifica que MAC destino en ARP = MAC destino en Ethernet  ! 'ip' - Verifica direcciones IP v\u00e1lidas (no 0.0.0.0, 255.255.255.255, etc.)\n! RATE LIMITING - CR\u00cdTICO PARA PREVENIR DOS\nSwitch(config)# interface fastethernet 0/5\nSwitch(config-if)# ip arp inspection limit rate 15\n! Limita a 15 paquetes ARP por segundo\n! Paquetes excedentes son descartados\n! Previene flood de ARP que podr\u00eda saturar la CPU\n</code></pre>"},{"location":"SecSwitches/#configuracion-integrada-con-dhcp-snooping","title":"Configuraci\u00f3n Integrada con DHCP Snooping","text":"<pre><code>! PRIMERO: Configurar DHCP Snooping (requisito para DAI)\nSwitch(config)# ip dhcp snooping\n! Habilita la funcionalidad global de DHCP Snooping\n\nSwitch(config)# ip dhcp snooping vlan 10,20\n! Especifica en qu\u00e9 VLANs actuar\u00e1 DHCP Snooping\n\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# ip dhcp snooping trust\n! Puertos trusted para DHCP (hacia servidores DHCP leg\u00edtimos)\n! SEGUNDO: Configurar DAI que usa la tabla de DHCP Snooping\nSwitch(config)# ip arp inspection vlan 10,20\n! DAI usar\u00e1 la tabla de bindings de DHCP Snooping para validar\n\nSwitch(config)# ip arp inspection log-buffer entries 1024\n! Buffer para almacenar logs de violaciones ARP\n\nSwitch(config)# ip arp inspection log-buffer logs 10 interval 60\n! Genera logs cada 60 segundos si hay m\u00e1s de 10 violaciones\n\n! CONFIGURACI\u00d3N POR PUERTO DE USUARIO\nSwitch(config)# interface range fastethernet 0/1-24\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# ip arp inspection limit rate 10\n! Todos los puertos de usuario tienen rate limiting\n! Por defecto son untrusted (inspeccionados)\n</code></pre>"},{"location":"SecSwitches/#ejemplo-practico-completo_2","title":"Ejemplo Pr\u00e1ctico Completo","text":"<pre><code>! ESCENARIO: Red corporativa con m\u00faltiples VLANs\n\n! 1. Configurar DHCP Snooping\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10,20,30\nSwitch(config)# ip dhcp snooping information option\n! 'information option' a\u00f1ade informaci\u00f3n adicional (option 82)\n! 2. Definir puertos trusted\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# description UPLINK_TO_CORE_SWITCH\nSwitch(config-if)# ip dhcp snooping trust\nSwitch(config-if)# ip arp inspection trust\nSwitch(config)# interface gigabitethernet 0/2  \nSwitch(config-if)# description LINK_TO_DHCP_SERVER\nSwitch(config-if)# ip dhcp snooping trust\nSwitch(config-if)# ip arp inspection trust\n! 3. Configurar DAI\nSwitch(config)# ip arp inspection vlan 10,20,30\nSwitch(config)# ip arp inspection validate src-mac dst-mac ip\nSwitch(config)# ip arp inspection log-buffer entries 2048\n! 4. Configurar puertos de usuario\nSwitch(config)# interface range fastethernet 0/1-48\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# ip arp inspection limit rate 15\nSwitch(config-if-range)# no ip dhcp snooping trust\n! Expl\u00edcitamente configurados como untrusted\n\n! VERIFICACI\u00d3N\nSwitch# show ip arp inspection\n! Muestra configuraci\u00f3n global de DAI\n\nSwitch# show ip arp inspection statistics\n! Muestra contadores de paquetes procesados y descartados\n\nSwitch# show ip dhcp snooping binding\n! Muestra la tabla de bindings IP-MAC-puerto\n! ESTA TABLA ES LA QUE USA DAI PARA VALIDAR\n\nSwitch# show ip arp inspection interface fastethernet 0/10\n! Muestra estad\u00edsticas espec\u00edficas por puerto\n</code></pre>"},{"location":"SecSwitches/#4-bpdu-guard-bpdu-filter","title":"\ud83c\udf09 4. BPDU Guard &amp; BPDU Filter","text":""},{"location":"SecSwitches/#concepto-teorico-detallado_3","title":"Concepto Te\u00f3rico Detallado","text":"<p>\u00bfQu\u00e9 son las BPDUs? BPDU (Bridge Protocol Data Units) son mensajes que intercambian los switches para construir y mantener el spanning-tree.</p> <p>Problemas que resuelven:</p> <ul> <li>Switches no autorizados: Usuario conecta un switch casero</li> <li>Bucles de red: Configuraciones incorrectas crean loops</li> <li>Interrupciones de servicio: Topolog\u00eda STP cambia inesperadamente</li> </ul>"},{"location":"SecSwitches/#bpdu-guard-explicacion-detallada","title":"BPDU Guard - Explicaci\u00f3n Detallada","text":"<p>Prop\u00f3sito: Proteger puertos de acceso contra recepci\u00f3n de BPDUs</p> <p>Comportamiento: - Si recibe BPDU \u2192 err-disable inmediato - Ideal para puertos con usuarios finales - Se activa solo en puertos con PortFast</p>"},{"location":"SecSwitches/#comandos-bpdu-guard","title":"Comandos BPDU Guard","text":"<pre><code>! M\u00c9TODO 1: Global (recomendado para consistencia)\nSwitch(config)# spanning-tree portfast bpduguard default\n! Aplica BPDU Guard autom\u00e1ticamente a TODOS los puertos con PortFast\n! M\u00c9TODO M\u00c1S EFICIENTE para despliegues grandes\n\n! M\u00c9TODO 2: Por interfaz\nSwitch(config)# interface fastethernet 0/1\nSwitch(config-if)# spanning-tree portfast\n! PortFast salta estados temporales (listening/learning)\nSwitch(config-if)# spanning-tree bpduguard enable\n! Habilita BPDU Guard espec\u00edficamente en este puerto\n\n! RECUPERACI\u00d3N AUTOM\u00c1TICA\nSwitch(config)# errdisable recovery cause bpduguard\nSwitch(config)# errdisable recovery interval 300\n! Reactiva puertos autom\u00e1ticamente despu\u00e9s de 5 minutos\n</code></pre>"},{"location":"SecSwitches/#bpdu-filter-explicacion-detallada","title":"BPDU Filter - Explicaci\u00f3n Detallada","text":"<p>Prop\u00f3sito: Silenciar BPDUs en puertos espec\u00edficos</p> <p>Comportamiento:</p> <ul> <li>Bloquea env\u00edo y recepci\u00f3n de BPDUs</li> <li>Peligroso: Puede crear bucles si no se usa correctamente</li> <li>Caso de uso: Conectar dispositivos que env\u00edan BPDUs pero no deben participar en STP</li> </ul>"},{"location":"SecSwitches/#comandos-bpdu-filter","title":"Comandos BPDU Filter","text":"<pre><code>! M\u00c9TODO 1: Global\nSwitch(config)# spanning-tree portfast bpdufilter default\n! Aplica BPDU Filter a todos los puertos con PortFast\n! CUIDADO: Puede causar bucles si se conecta un switch\n\n! M\u00c9TODO 2: Por interfaz\nSwitch(config)# interface fastethernet 0/2\nSwitch(config-if)# spanning-tree bpdufilter enable\n! Habilita BPDU Filter espec\u00edficamente en este puerto\n</code></pre>"},{"location":"SecSwitches/#ejemplo-practico-cuando-usar-cada-uno","title":"Ejemplo Pr\u00e1ctico: Cu\u00e1ndo Usar Cada Uno","text":"<pre><code>! ESCENARIO: Oficina con diferentes tipos de puertos\n\n! 1. Puertos de usuario normal - USAR BPDU GUARD\nSwitch(config)# interface range fastethernet 0/1-20\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# spanning-tree portfast\nSwitch(config-if-range)# spanning-tree bpduguard enable\nSwitch(config-if-range)# description USUARIOS_FINALES\n! Si alguien conecta un switch, el puerto se desactiva\n\n! 2. Servidor que env\u00eda BPDUs - USAR BPDU FILTER\nSwitch(config)# interface fastethernet 0/21\nSwitch(config-if)# switchport mode access  \nSwitch(config-if)# spanning-tree bpdufilter enable\nSwitch(config-if)# description SERVIDOR_VMWARE\n! El servidor puede enviar BPDUs pero no queremos que participe en STP\n\n! 3. Configuraci\u00f3n global de seguridad\nSwitch(config)# spanning-tree portfast bpduguard default\n! Para todos los nuevos puertos con PortFast\n\nSwitch(config)# errdisable recovery cause bpduguard\nSwitch(config)# errdisable recovery interval 600\n! Recuperaci\u00f3n autom\u00e1tica despu\u00e9s de 10 minutos\n\n! VERIFICACI\u00d3N\nSwitch# show spanning-tree summary\n! Muestra estado global de spanning-tree incluyendo BPDU Guard/Filter\n\nSwitch# show spanning-tree interface fastethernet 0/1 detail\n! Muestra configuraci\u00f3n espec\u00edfica de BPDU Guard/Filter por puerto\n\nSwitch# show errdisable recovery\n! Muestra configuraci\u00f3n de recuperaci\u00f3n autom\u00e1tica\n</code></pre>"},{"location":"SecSwitches/#5-ip-source-guard","title":"\ud83d\udd0d 5. IP Source Guard","text":""},{"location":"SecSwitches/#concepto-teorico-detallado_4","title":"Concepto Te\u00f3rico Detallado","text":"<p>\u00bfQu\u00e9 es IP Source Guard? Es un mecanismo que filtra tr\u00e1fico IP bas\u00e1ndose en la tabla de bindings de DHCP Snooping.</p> <p>Problemas que resuelve:</p> <ul> <li>IP spoofing: Usuario usa IP que no le pertenece</li> <li>Ataques DoS: Dispositivos maliciosos suplantando IPs</li> <li>Robo de servicios: Usar IPs de otros departamentos</li> </ul> <p>C\u00f3mo funciona:</p> <ol> <li>Aprende bindings IP-MAC de DHCP Snooping</li> <li>Instala filtros en hardware del switch</li> <li>Permite solo tr\u00e1fico de IPs autorizadas</li> <li>Actualiza din\u00e1micamente cuando expiran leases DHCP</li> </ol>"},{"location":"SecSwitches/#comandos-explicados-paso-a-paso_3","title":"Comandos Explicados Paso a Paso","text":"<pre><code>! PRERREQUISITO: DHCP Snooping debe estar configurado\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10\n! CONFIGURACI\u00d3N B\u00c1SICA DE IP SOURCE GUARD\nSwitch(config)# interface fastethernet 0/1\nSwitch(config-if)# ip verify source\n! Habilita verificaci\u00f3n de direcci\u00f3n IP origen\n! Solo permite tr\u00e1fico de IPs que est\u00e1n en la tabla de DHCP Snooping\n\n! CONFIGURACI\u00d3N AVANZADA CON VERIFICACI\u00d3N MAC\nSwitch(config-if)# ip verify source port-security\n! 'port-security' a\u00f1ade verificaci\u00f3n de direcci\u00f3n MAC tambi\u00e9n\n! M\u00e1s seguro pero requiere que Port Security est\u00e9 configurado\n\nSwitch(config-if)# ip verify source vlan dhcp-snooping port-security\n! Verificaci\u00f3n completa: IP + MAC + VLAN\n! M\u00c1XIMA SEGURIDAD pero m\u00e1s complejo de implementar\n</code></pre>"},{"location":"SecSwitches/#ejemplo-practico-completo_3","title":"Ejemplo Pr\u00e1ctico Completo","text":"<pre><code>! ESCENARIO: Red segura con validaci\u00f3n m\u00faltiple\n\n! 1. CONFIGURAR DHCP SNOOPING (BASE PARA TODO)\nSwitch(config)# ip dhcp snooping\nSwitch(config)# ip dhcp snooping vlan 10,20\nSwitch(config)# ip dhcp snooping information option\n! Definir puertos trusted\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# ip dhcp snooping trust\nSwitch(config-if)# description TO_DHCP_SERVER\n! 2. CONFIGURAR PORT SECURITY\nSwitch(config)# interface range fastethernet 0/1-24\nSwitch(config-if-range)# switchport mode access\nSwitch(config-if-range)# switchport port-security\nSwitch(config-if-range)# switchport port-security maximum 2\nSwitch(config-if-range)# switchport port-security violation restrict\nSwitch(config-if-range)# switchport port-security mac-address sticky\n! 3. CONFIGURAR IP SOURCE GUARD\nSwitch(config)# interface range fastethernet 0/1-24\nSwitch(config-if-range)# ip verify source port-security\n! Verifica tanto IP como direcci\u00f3n MAC\n! Solo permite tr\u00e1fico de dispositivos con binding v\u00e1lido\n\n! 4. CONFIGURACI\u00d3N ALTERNATIVA PARA DISPOSITIVOS EST\u00c1TICOS\nSwitch(config)# interface fastethernet 0/25\nSwitch(config-if)# description SERVIDOR_ESTATICO\nSwitch(config-if)# switchport mode access\nSwitch(config-if)# switchport port-security\nSwitch(config-if)# switchport port-security mac-address 0050.5687.1234\nSwitch(config-if)# ip verify source\n! Para servidores con IP est\u00e1tica, solo verificaci\u00f3n de IP\n\n! VERIFICACI\u00d3N COMPLETA\nSwitch# show ip verify source\n! Muestra tabla de bindings activos y estado de verificaci\u00f3n\n\nSwitch# show ip source binding\n! Muestra toda la tabla de bindings IP-MAC-VLAN\n\nSwitch# show ip dhcp snooping binding\n! Muestra bindings aprendidos via DHCP\n\nSwitch# show port-security address\n! Muestra direcciones MAC seguras\n\n! MONITOREO EN TIEMPO REAL\nSwitch# debug ip dhcp snooping events\n! Para troubleshooting detallado (usar con cuidado en producci\u00f3n)\n</code></pre>"},{"location":"SecSwitches/#configuracion-integrada-completa","title":"\ud83c\udfd7\ufe0f CONFIGURACI\u00d3N INTEGRADA COMPLETA","text":""},{"location":"SecSwitches/#switch-de-acceso-corporativo-seguro","title":"Switch de Acceso Corporativo Seguro","text":"<pre><code>! INICIALIZACI\u00d3N B\u00c1SICA\nSwitch&gt; enable\nSwitch# configure terminal\nSwitch(config)# hostname SW-ACCESO-01\n! CONFIGURACI\u00d3N DE VLANs\nSW-ACCESO-01(config)# vlan 10\nSW-ACCESO-01(config-vlan)# name USUARIOS\nSW-ACCESO-01(config-vlan)# vlan 20\nSW-ACCESO-01(config-vlan)# name SERVIDORES\nSW-ACCESO-01(config-vlan)# vlan 99\nSW-ACCESO-01(config-vlan)# name ADMIN\nSW-ACCESO-01(config-vlan)# vlan 999\nSW-ACCESO-01(config-vlan)# name NATIVA\nSW-ACCESO-01(config-vlan)# exit\n! CONFIGURACI\u00d3N DE ADMINISTRACI\u00d3N\nSW-ACCESO-01(config)# interface vlan 99\nSW-ACCESO-01(config-if)# ip address 192.168.99.10 255.255.255.0\nSW-ACCESO-01(config-if)# no shutdown\nSW-ACCESO-01(config-if)# exit\n! CONFIGURACI\u00d3N DE PUERTOS UPLINK (TRUSTED)\nSW-ACCESO-01(config)# interface gigabitethernet 0/1\nSW-ACCESO-01(config-if)# description UPLINK_TO_CORE_SWITCH\nSW-ACCESO-01(config-if)# switchport mode trunk\nSW-ACCESO-01(config-if)# switchport trunk native vlan 999\nSW-ACCESO-01(config-if)# switchport trunk allowed vlan 10,20,99\nSW-ACCESO-01(config-if)# ip dhcp snooping trust\nSW-ACCESO-01(config-if)# ip arp inspection trust\nSW-ACCESO-01(config-if)# spanning-tree guard root\nSW-ACCESO-01(config-if)# no shutdown\n! CONFIGURACI\u00d3N DE PUERTOS DE USUARIO (UNTRUSTED)\nSW-ACCESO-01(config)# interface range fastethernet 0/1-24\nSW-ACCESO-01(config-if-range)# description PUERTOS_USUARIOS\nSW-ACCESO-01(config-if-range)# switchport mode access\nSW-ACCESO-01(config-if-range)# switchport access vlan 10\nSW-ACCESO-01(config-if-range)# switchport port-security\nSW-ACCESO-01(config-if-range)# switchport port-security maximum 3\nSW-ACCESO-01(config-if-range)# switchport port-security violation shutdown\nSW-ACCESO-01(config-if-range)# switchport port-security mac-address sticky\nSW-ACCESO-01(config-if-range)# switchport port-security aging time 120\nSW-ACCESO-01(config-if-range)# spanning-tree portfast\nSW-ACCESO-01(config-if-range)# spanning-tree bpduguard enable\nSW-ACCESO-01(config-if-range)# ip verify source port-security\nSW-ACCESO-01(config-if-range)# ip arp inspection limit rate 15\nSW-ACCESO-01(config-if-range)# no ip dhcp snooping trust\nSW-ACCESO-01(config-if-range)# no shutdown\n! CONFIGURACI\u00d3N DE PUERTOS DE SERVIDORES\nSW-ACCESO-01(config)# interface range gigabitethernet 0/2-4\nSW-ACCESO-01(config-if-range)# description SERVIDORES\nSW-ACCESO-01(config-if-range)# switchport mode access\nSW-ACCESO-01(config-if-range)# switchport access vlan 20\nSW-ACCESO-01(config-if-range)# switchport port-security\nSW-ACCESO-01(config-if-range)# switchport port-security maximum 1\nSW-ACCESO-01(config-if-range)# switchport port-security violation shutdown\nSW-ACCESO-01(config-if-range)# spanning-tree portfast\nSW-ACCESO-01(config-if-range)# spanning-tree bpduguard enable\nSW-ACCESO-01(config-if-range)# ip verify source\nSW-ACCESO-01(config-if-range)# no shutdown\n! CONFIGURACIONES GLOBALES DE SEGURIDAD\nSW-ACCESO-01(config)# ip dhcp snooping\nSW-ACCESO-01(config)# ip dhcp snooping vlan 10,20\nSW-ACCESO-01(config)# ip dhcp snooping information option\nSW-ACCESO-01(config)# ip arp inspection vlan 10,20\nSW-ACCESO-01(config)# ip arp inspection validate src-mac dst-mac ip\nSW-ACCESO-01(config)# ip arp inspection log-buffer entries 1024\nSW-ACCESO-01(config)# spanning-tree portfast bpduguard default\nSW-ACCESO-01(config)# spanning-tree portfast bpdufilter default\n! RECUPERACI\u00d3N AUTOM\u00c1TICA\nSW-ACCESO-01(config)# errdisable recovery cause all\nSW-ACCESO-01(config)# errdisable recovery interval 600\n! GUARDAR CONFIGURACI\u00d3N\nSW-ACCESO-01(config)# end\nSW-ACCESO-01# copy running-config startup-config\n</code></pre>"},{"location":"SecSwitches/#comandos-de-verificacion-y-monitoreo_1","title":"Comandos de Verificaci\u00f3n y Monitoreo","text":"<pre><code>! VERIFICACI\u00d3N COMPLETA DEL ESTADO\nSW-ACCESO-01# show running-config\nSW-ACCESO-01# show vlan brief\nSW-ACCESO-01# show interfaces status\n\n! VERIFICACI\u00d3N DE SEGURIDAD\nSW-ACCESO-01# show port-security\nSW-ACCESO-01# show port-security address\nSW-ACCESO-01# show ip dhcp snooping\nSW-ACCESO-01# show ip arp inspection\nSW-ACCESO-01# show ip verify source\n! ESTAD\u00cdSTICAS Y MONITOREO\nSW-ACCESO-01# show interface counters errors\nSW-ACCESO-01# show errdisable recovery\nSW-ACCESO-01# show logging\n\n! TROUBLESHOOTING ESPEC\u00cdFICO\nSW-ACCESO-01# show mac address-table interface fastethernet 0/1\nSW-ACCESO-01# show ip dhcp snooping binding\nSW-ACCESO-01# show spanning-tree interface fastethernet 0/1 detail\n</code></pre>"},{"location":"SecSwitches/#resumen-final-de-mejores-practicas","title":"\ud83c\udfaf RESUMEN FINAL DE MEJORES PR\u00c1CTICAS","text":""},{"location":"SecSwitches/#recomendaciones-por-tecnologia","title":"Recomendaciones por Tecnolog\u00eda:","text":"<ol> <li> <p>VLANs:</p> <ul> <li>Nunca usar VLAN 1 para tr\u00e1fico de usuario</li> <li>VLAN nativa diferente para cada trunk</li> <li>Segmentar por funci\u00f3n, no solo por ubicaci\u00f3n</li> </ul> </li> <li> <p>Port Security:</p> <ul> <li>Usar \"violation shutdown\" en entornos seguros</li> <li>\"sticky\" para despliegues iniciales</li> <li>Rate limiting en puertos de alta densidad</li> </ul> </li> <li> <p>DAI:</p> <ul> <li>Siempre con DHCP Snooping primero</li> <li>Rate limiting esencial para prevenir DoS</li> <li>Validaci\u00f3n completa (src-mac + dst-mac + ip)</li> </ul> </li> <li> <p>BPDU Guard:</p> <ul> <li>Global + PortFast para consistencia</li> <li>Recuperaci\u00f3n autom\u00e1tica configurada</li> <li>Nunca en puertos trunk</li> </ul> </li> <li> <p>IP Source Guard:</p> <ul> <li>Requiere DHCP Snooping funcionando</li> <li>\"port-security\" para m\u00e1xima seguridad</li> <li>Monitorizar bindings regularmente</li> </ul> </li> </ol>"},{"location":"SecSwitches/#flujo-de-implementacion-recomendado","title":"Flujo de Implementaci\u00f3n Recomendado:","text":"<ol> <li>VLANs y segmentaci\u00f3n</li> <li>Port Security b\u00e1sica</li> <li>DHCP Snooping</li> <li>DAI con validaciones</li> <li>BPDU Guard</li> <li>IP Source Guard</li> <li>Verificaci\u00f3n y ajuste</li> </ol>"},{"location":"SecSwitches/#portfast","title":"Portfast","text":"<p>PortFast es una funcionalidad de los switches Cisco que se configura en puertos de acceso que conectan estaciones de trabajo finales (como PCs, impresoras, servidores) y nunca otros switches o dispositivos de red. \u00bfQu\u00e9 hace PortFast?</p> <pre><code>Objetivo principal: Acelerar el inicio de un puerto cuando se enciende un dispositivo conectado a \u00e9l.\n\nFuncionamiento normal (sin PortFast): Cuando un puerto de switch se activa, el protocolo Spanning Tree (STP) pasa por una serie de estados antes de permitir el tr\u00e1fico de datos:\nBloqueando \u2192 Escuchando \u2192 Aprendiendo \u2192 Reenv\u00edo\nEste proceso puede tomar unos 30 segundos.\n\nFuncionamiento con PortFast: El puerto se salta los estados de \"Escuchando\" y \"Aprendiendo\" y pasa inmediatamente al estado de \"Reenv\u00edo\", permitiendo el tr\u00e1fico casi al instante.\n</code></pre> <p>Analog\u00eda R\u00e1pida</p> <pre><code>Sin PortFast: Es como arrancar un coche en un d\u00eda fr\u00edo: dejar que el motor se caliente antes de poder circular.\n\nCon PortFast: Es como tener el coche ya caliente y listo para circular en cuanto giras la llave.\n</code></pre> <p>Puntos Clave y Advertencias</p> <pre><code>\u00bfD\u00f3nde se usa? Solo en puertos de acceso que conectan dispositivos finales.\n\n\u00bfQu\u00e9 evita? La espera de 30 segundos para que un usuario obtenga una direcci\u00f3n IP (DHCP) o pueda empezar a navegar.\n\n\u00a1ADVERTENCIA CRUCIAL! NUNCA actives PortFast en un puerto que conecte a otro switch, hub o router. Esto podr\u00eda crear bucles de capa 2 en la red, ya que STP no tendr\u00eda tiempo de detectarlos y bloquearlos.\n</code></pre> <p>Relaci\u00f3n con BPDU Guard</p> <p>PortFast suele ir de la mano con BPDU Guard. Si un usuario conecta por error un switch a un puerto con PortFast, BPDU Guard detectar\u00e1 el paquete BPDU (propio de STP) y desactivar\u00e1 el puerto inmediatamente, evitando as\u00ed un posible bucle. Es el \"seguro de seguridad\" de PortFast.</p> <p>En resumen: PortFast es una optimizaci\u00f3n para puertos de usuarios finales que acelera el acceso a la red, salt\u00e1ndose los lentos estados de STP.</p>"},{"location":"SecSwitches/#configuracion-de-portfast","title":"Configuraci\u00f3n de PortFast","text":""},{"location":"SecSwitches/#1-por-interfaz-recomendado","title":"1. Por interfaz (recomendado)","text":"<pre><code>Switch# configure terminal\nSwitch(config)# interface [tipo-n\u00famero]  # Ej: gigabitethernet 0/1\nSwitch(config-if)# spanning-tree portfast\n</code></pre> <p>Para habilitar BPDU Guard en la misma interfaz: <pre><code>Switch(config-if)# spanning-tree bpduguard enable\n</code></pre></p>"},{"location":"SecSwitches/#2-de-forma-global-mas-rapido","title":"2. De forma global (m\u00e1s r\u00e1pido)","text":"<p>Habilita PortFast en todas las interfaces que no son trunk y est\u00e1n en estado connected: <pre><code>Switch# configure terminal\nSwitch(config)# spanning-tree portfast default\n</code></pre></p> <p>Para habilitar BPDU Guard de forma global: <pre><code>Switch(config)# spanning-tree portfast bpduguard default\n</code></pre></p>"},{"location":"SecSwitches/#verificacion","title":"Verificaci\u00f3n","text":"<p><pre><code>Switch# show spanning-tree interface [tipo-n\u00famero] detail\n</code></pre> Busca en la salida: - <code>Portfast enabled</code> - <code>Bpdu guard enabled</code></p>"},{"location":"SecSwitches/#comandos-importantes-para-aclarar-dudas","title":"Comandos importantes para aclarar dudas","text":"<p>\u00bfLa interfaz es de acceso o trunk? <pre><code>Switch# show interfaces [tipo-n\u00famero] switchport\n</code></pre></p> <p>\u00bfSe han recibido BPDUs en el puerto? <pre><code>Switch# show spanning-tree interface [tipo-n\u00famero] detail\n</code></pre></p> <p>Si BPDU Guard desactiva un puerto: <pre><code>Switch# show interfaces status err-disabled\nSwitch# enable\nSwitch# configure terminal\nSwitch(config)# interface [tipo-n\u00famero]\nSwitch(config-if)# shutdown\nSwitch(config-if)# no shutdown\n</code></pre></p>"},{"location":"SecSwitches/#recordatorio-importante","title":"\u26a0\ufe0f Recordatorio importante","text":"<p>SOLO uses PortFast en puertos que conecten dispositivos finales (PCs, impresoras, servidores). NUNCA en puertos que conecten a otros switches, routers o puntos de acceso inal\u00e1mbricos, ya que podr\u00edas causar bucles en la red.</p> <p>La combinaci\u00f3n PortFast + BPDU Guard es la pr\u00e1ctica m\u00e1s segura y com\u00fan.</p>"},{"location":"cheatsheet_routers/","title":"Cheatsheet routers","text":"<p>\u00a1Claro! Aqu\u00ed tienes una cheatsheet completa con comandos b\u00e1sicos de configuraci\u00f3n en routers Cisco, ideal para quienes est\u00e1n empezando.</p>"},{"location":"cheatsheet_routers/#cheatsheet-configuracion-basica-router-cisco","title":"\ud83d\ude80 Cheatsheet: Configuraci\u00f3n B\u00e1sica Router Cisco","text":""},{"location":"cheatsheet_routers/#1-modos-de-operacion","title":"1. Modos de Operaci\u00f3n","text":"<pre><code>User EXEC Mode        &gt; Privileged EXEC Mode  # enable\nGlobal Config Mode    # configure terminal\nInterface Config Mode (config-if)# interface &lt;tipo&gt; &lt;n\u00fam&gt;\nLine Config Mode      (config-line)# line &lt;tipo&gt; &lt;n\u00fam&gt;\n</code></pre>"},{"location":"cheatsheet_routers/#2-comandos-basicos-de-navegacion","title":"2. Comandos B\u00e1sicos de Navegaci\u00f3n","text":"<pre><code># Entrar a modo privilegiado\n&gt; enable\n# Entrar a configuraci\u00f3n global\n# configure terminal\n# Salir de un modo o guardar config\n(config)# exit\n(config)# end\n# write memory       # Guardar configuraci\u00f3n\n# copy running-config startup-config\n</code></pre>"},{"location":"cheatsheet_routers/#3-configuracion-de-passwords","title":"3. Configuraci\u00f3n de Passwords","text":""},{"location":"cheatsheet_routers/#password-para-modo-privilegiado-enable","title":"Password para Modo Privilegiado (Enable)","text":"<pre><code>(config)# enable secret miPasswordSeguro\n</code></pre>"},{"location":"cheatsheet_routers/#password-para-consola","title":"Password para Consola","text":"<pre><code>(config)# line console 0\n(config-line)# password consolePass\n(config-line)# login\n(config-line)# exit\n</code></pre>"},{"location":"cheatsheet_routers/#password-para-lineas-vty-telnetssh","title":"Password para L\u00edneas VTY (Telnet/SSH)","text":"<pre><code>(config)# line vty 0 4\n(config-line)# password vtyPass\n(config-line)# login\n(config-line)# exit\n</code></pre>"},{"location":"cheatsheet_routers/#4-cifrado-de-passwords","title":"4. Cifrado de Passwords","text":"<pre><code># Cifrar todas las passwords en texto claro\n(config)# service password-encryption\n# Ver passwords cifradas\n# show running-config\n</code></pre>"},{"location":"cheatsheet_routers/#5-configuracion-de-banners","title":"5. Configuraci\u00f3n de Banners","text":"<pre><code># Banner de aviso (MOTD)\n(config)# banner motd #\n\u00a1Acceso Autorizado Solo a Personal Autorizado! #\n# Banner de login\n(config)# banner login #\nBienvenido. Introduzca sus credenciales.\n#\n</code></pre>"},{"location":"cheatsheet_routers/#6-configuracion-de-interfaces","title":"6. Configuraci\u00f3n de Interfaces","text":""},{"location":"cheatsheet_routers/#interfaz-fastethernet","title":"Interfaz FastEthernet","text":"<pre><code>(config)# interface fastethernet 0/0\n(config-if)# ip address 192.168.1.1 255.255.255.0\n(config-if)# no shutdown\n(config-if)# description LAN-Office\n(config-if)# exit\n</code></pre>"},{"location":"cheatsheet_routers/#interfaz-serial-wan","title":"Interfaz Serial (WAN)","text":"<pre><code>(config)# interface serial 0/0/0\n(config-if)# ip address 10.0.0.1 255.255.255.252\n(config-if)# clock rate 64000    # Solo en lado DCE\n(config-if)# no shutdown\n(config-if)# exit\n</code></pre>"},{"location":"cheatsheet_routers/#7-configuracion-basica-de-seguridad","title":"7. Configuraci\u00f3n B\u00e1sica de Seguridad","text":""},{"location":"cheatsheet_routers/#deshabilitar-dns-lookup","title":"Deshabilitar DNS Lookup","text":"<pre><code>(config)# no ip domain-lookup\n</code></pre>"},{"location":"cheatsheet_routers/#configurar-nombre-de-host","title":"Configurar Nombre de Host","text":"<pre><code>(config)# hostname R1-Madrid\n</code></pre>"},{"location":"cheatsheet_routers/#configurar-domain-name","title":"Configurar Domain Name","text":"<pre><code>(config)# ip domain-name empresa.com\n</code></pre>"},{"location":"cheatsheet_routers/#8-configuracion-ssh-recomendado-sobre-telnet","title":"8. Configuraci\u00f3n SSH (Recomendado sobre Telnet)","text":"<pre><code># Generar claves RSA\n(config)# crypto key generate rsa modulus 2048\n# Configurar SSH\n(config)# ip ssh version 2\n(config)# username admin secret admin123\n# Configurar l\u00edneas VTY para SSH\n(config)# line vty 0 4\n(config-line)# transport input ssh\n(config-line)# login local\n(config-line)# exit\n</code></pre>"},{"location":"cheatsheet_routers/#9-comandos-de-verificacion-utiles","title":"9. Comandos de Verificaci\u00f3n \u00datiles","text":"<pre><code># Ver configuraci\u00f3n actual\n# show running-config\n# Ver interfaces y estado\n# show ip interface brief\n# Ver tabla de routing\n# show ip route\n# Ver resumen de interfaces\n# show interfaces description\n# Ver conexiones SSH\n# show ssh\n</code></pre>"},{"location":"cheatsheet_routers/#10-configuracion-basica-de-routing-estatico","title":"10. Configuraci\u00f3n B\u00e1sica de Routing Est\u00e1tico","text":"<pre><code># Ruta est\u00e1tica hacia red remota\n(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2\n# Ruta por defecto\n(config)# ip route 0.0.0.0 0.0.0.0 10.0.0.2\n</code></pre>"},{"location":"cheatsheet_routers/#11-comandos-de-administracion","title":"11. Comandos de Administraci\u00f3n","text":"<pre><code># Guardar configuraci\u00f3n\n# copy running-config startup-config\n# Recargar router\n# reload\n# Ver versi\u00f3n del IOS\n# show version\n# Ver tiempo de actividad\n# show uptime\n</code></pre>"},{"location":"cheatsheet_routers/#ejemplo-de-configuracion-completa-basica","title":"\ud83c\udf10 Ejemplo de Configuraci\u00f3n Completa B\u00e1sica","text":"<pre><code>enable\nconfigure terminal\n\n! Configuraci\u00f3n b\u00e1sica\nhostname R1-Oficina\nno ip domain-lookup\nservice password-encryption\n\n! Passwords\nenable secret MiSecurePass123\nline console 0\npassword console123\n login\n exit\nline vty 0 4\npassword vty123\n login\n transport input ssh\n exit\n! Interfaces\ninterface fastethernet 0\n</code></pre>"},{"location":"dtp/","title":"DTP (Dynamic Trunking Protocol)","text":""},{"location":"dtp/#que-es-dtp","title":"\u00bfQu\u00e9 es DTP?","text":"<p>DTP (Dynamic Trunking Protocol) es un protocolo propietario de Cisco que negocia autom\u00e1ticamente la formaci\u00f3n de enlaces trunk entre switches Cisco. Opera en la capa 2 del modelo OSI.</p>"},{"location":"dtp/#proposito-principal","title":"Prop\u00f3sito Principal","text":"<p>DTP elimina la necesidad de configurar manualmente los enlaces trunk, permitiendo que los switches negocien autom\u00e1ticamente si un puerto debe operar como: - Access (puerto de acceso) - Trunk (puerto troncal)</p>"},{"location":"dtp/#modos-de-operacion-dtp","title":"Modos de Operaci\u00f3n DTP","text":""},{"location":"dtp/#1-dynamic-auto","title":"1. Dynamic Auto","text":"<p><pre><code>Switch(config-if)# switchport mode dynamic auto\n</code></pre> - Espera a que el otro dispositivo solicite formar trunk - No env\u00eda frames DTP, pero responde a ellos - Resultado: Forma trunk solo si el otro lado es \"desirable\"</p> <p>Escenarios t\u00edpicos:</p> <ul> <li> <p>Enlaces entre switches donde NO quieres ser el iniciador</p> </li> <li> <p>Entornos con pol\u00edtica \"esperar a ser invitado\"</p> </li> <li> <p>Conexiones a dispositivos que pueden cambiar configuraci\u00f3n</p> </li> <li> <p>Cuando el otro lado debe decidir si forma trunk</p> </li> </ul> <p>Por qu\u00e9 usarlo:</p> <pre><code>\u2705 Menos agresivo - No inicia trunks no deseados\n\n\u2705 Seguridad moderada - Solo forma trunk si el otro lado lo pide\n\n\u2705 Flexibilidad - Se adapta a la configuraci\u00f3n del peer\n\n\u2705 Bajo overhead - No env\u00eda DTP activamente\n</code></pre>"},{"location":"dtp/#2-dynamic-desirable","title":"2. Dynamic Desirable","text":"<p><pre><code>Switch(config-if)# switchport mode dynamic desirable\n</code></pre> - Env\u00eda activamente frames DTP para negociar trunk - Forma trunk si el otro lado es \"auto\", \"desirable\" o \"trunk\" - Modo m\u00e1s agresivo</p> <p>Escenarios t\u00edpicos:</p> <ul> <li> <p>Enlaces troncales entre switches en mismo dominio administrativo</p> </li> <li> <p>Entornos din\u00e1micos donde se a\u00f1aden/eliminan VLANs frecuentemente</p> </li> <li> <p>Conexiones entre switches de mismo nivel</p> </li> <li> <p>Cuando quieres auto-configuraci\u00f3n pero con iniciativa</p> </li> </ul> <p>Por qu\u00e9 usarlo:</p> <pre><code>\u2705 Auto-configuraci\u00f3n - Forma trunks autom\u00e1ticamente\n\n\u2705 Flexibilidad - Se adapta a cambios de configuraci\u00f3n\n\n\u2705 Conveniencia - Reduce configuraci\u00f3n manual\n\n\u2705 Compatibilidad - Funciona con \"auto\" y \"trunk\"\n</code></pre>"},{"location":"dtp/#3-trunk","title":"3. Trunk","text":"<p><pre><code>Switch(config-if)# switchport mode trunk\n</code></pre> - Fuerza el puerto como trunk permanentemente - Env\u00eda frames DTP - Espera que el otro lado sea \"auto\", \"desirable\" o \"trunk\"</p> <p>Escenarios t\u00edpicos:</p> <ul> <li> <p>Enlaces a routers o firewalls</p> </li> <li> <p>Conexiones a servidores con m\u00faltiples VLANs</p> </li> <li> <p>Enlaces troncales cr\u00edticos que NO deben cambiar</p> </li> <li> <p>Entornos de alta seguridad</p> </li> </ul> <p>Por qu\u00e9 usarlo:</p> <pre><code>\u2705 M\u00e1xima estabilidad - No cambia de estado\n\n\u2705 Seguridad - No negocia con dispositivos no autorizados\n\n\u2705 Control total - Configuraci\u00f3n expl\u00edcita\n\n\u2705 Rendimiento - Sin overhead de negociaci\u00f3n constante\n</code></pre>"},{"location":"dtp/#4-access","title":"4. Access","text":"<p><pre><code>Switch(config-if)# switchport mode access\n</code></pre> - Fuerza el puerto como acceso - No env\u00eda frames DTP - Rechaza negociaci\u00f3n de trunk</p> <p>Escenarios t\u00edpicos:</p> <ul> <li> <p>Puertos para usuarios finales (PCs, tel\u00e9fonos, impresoras)</p> </li> <li> <p>Puertos de guest/wifi</p> </li> <li> <p>Conexiones a dispositivos que no soportan trunking</p> </li> <li> <p>Entornos de m\u00e1xima seguridad</p> </li> </ul> <p>Por qu\u00e9 usarlo:</p> <pre><code>\u2705 M\u00e1xima seguridad - Sin negociaci\u00f3n de trunk\n\n\u2705 Estabilidad - Comportamiento predecible\n\n\u2705 Prevenci\u00f3n de VLAN hopping - Elimina riesgo de ataques\n\n\u2705 Simplicidad - F\u00e1cil troubleshooting\n</code></pre>"},{"location":"dtp/#5-nonegotiate","title":"5. Nonegotiate","text":"<p><pre><code>Switch(config-if)# switchport nonegotiate\n</code></pre> - Configura trunk pero deshabilita DTP - No env\u00eda frames de negociaci\u00f3n</p> <p>Escenarios t\u00edpicos:</p> <ul> <li> <p>Enlaces a equipos no-Cisco (que no entienden DTP)</p> </li> <li> <p>Conexiones a firewalls, load balancers</p> </li> <li> <p>Enlaces donde DTP causa problemas</p> </li> <li> <p>Entornos multi-vendor</p> </li> </ul> <p>Por qu\u00e9 usarlo:</p> <pre><code>\u2705 Compatibilidad multi-vendor - Sin protocolos propietarios\n\n\u2705 Seguridad - Sin anuncios DTP\n\n\u2705 Estabilidad - Trunk est\u00e1tico sin negociaci\u00f3n\n\n\u2705 Control - Configuraci\u00f3n manual expl\u00edcita\n</code></pre>"},{"location":"dtp/#tabla-de-compatibilidad-de-modos","title":"Tabla de Compatibilidad de Modos","text":"Lado A Lado B Resultado Dynamic Auto Dynamic Auto Access Dynamic Auto Dynamic Desirable Trunk Dynamic Desirable Dynamic Desirable Trunk Trunk Dynamic Auto Trunk Trunk Dynamic Desirable Trunk Access Cualquier modo Access"},{"location":"dtp/#comandos-de-configuracion","title":"Comandos de Configuraci\u00f3n","text":""},{"location":"dtp/#configuracion-basica","title":"Configuraci\u00f3n B\u00e1sica:","text":"<pre><code># Ver estado DTP\nSwitch# show dtp interface [interface]\n# Configurar modo DTP\nSwitch(config)# interface gigabitethernet 0/1\nSwitch(config-if)# switchport mode dynamic auto\nSwitch(config-if)# switchport mode dynamic desirable\nSwitch(config-if)# switchport mode trunk\nSwitch(config-if)# switchport mode access\n# Deshabilitar DTP\nSwitch(config-if)# switchport nonegotiate\n</code></pre>"},{"location":"dtp/#configuracion-de-vlan-nativa","title":"Configuraci\u00f3n de VLAN Nativa:","text":"<pre><code>Switch(config-if)# switchport trunk native vlan [vlan-id]\n</code></pre>"},{"location":"dtp/#ventajas-de-dtp","title":"Ventajas de DTP","text":"<p>\u2705 Configuraci\u00f3n autom\u00e1tica \u2705 Reduce errores manuales \u2705 Facilita la administraci\u00f3n \u2705 Compatibilidad entre dispositivos Cisco </p>"},{"location":"dtp/#desventajas-y-consideraciones","title":"Desventajas y Consideraciones","text":"<p>\u274c Solo funciona entre equipos Cisco \u274c Puede crear problemas de seguridad \u274c Overhead en la red \u274c En entornos seguros, se recomienda deshabilitar</p>"},{"location":"dtp/#mejores-practicas","title":"Mejores Pr\u00e1cticas","text":""},{"location":"dtp/#para-seguridad","title":"Para Seguridad:","text":"<pre><code># En puertos de acceso\nSwitch(config-if)# switchport mode access\nSwitch(config-if)# switchport nonegotiate\n# En puertos trunk (configuraci\u00f3n manual)\nSwitch(config-if)# switchport mode trunk\nSwitch(config-if)# switchport nonegotiate\nSwitch(config-if)# switchport trunk allowed vlan [vlan-list]\n</code></pre>"},{"location":"dtp/#verificacion","title":"Verificaci\u00f3n:","text":"<pre><code># Ver estado DTP\nSwitch# show dtp interface gigabitethernet 0/1\n\n# Ver resumen de interfaces\nSwitch# show interfaces trunk\n\n# Ver configuraci\u00f3n de puerto\nSwitch# show interfaces [interface] switchport\n</code></pre>"},{"location":"dtp/#ejemplo-practico","title":"Ejemplo Pr\u00e1ctico","text":""},{"location":"dtp/#escenario-dos-switches-interconectados","title":"Escenario: Dos switches interconectados","text":"<p><pre><code># Switch 1\nSwitch1(config)# interface gigabitethernet 0/1\nSwitch1(config-if)# switchport mode dynamic desirable\n# Switch 2  \nSwitch2(config)# interface gigabitethernet 0/1\nSwitch2(config-if)# switchport mode dynamic auto\n</code></pre> Resultado: Se formar\u00e1 un enlace trunk autom\u00e1ticamente.</p>"},{"location":"dtp/#seguridad-con-dtp","title":"Seguridad con DTP","text":"<p>En entornos de producci\u00f3n, se recomienda: - Deshabilitar DTP en puertos de acceso - Configurar trunks manualmente - Usar <code>switchport nonegotiate</code> en trunks configurados manualmente</p>"}]}